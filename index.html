<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#007bff" />
<link rel="icon" href="icon-192.png" />

<title>Buku Tamu Digital</title>
<style>
    /* Mengatur Box Model untuk Tata Letak Responsif */
input:focus, select:focus, textarea:focus {
  outline: none;
  border: 2px solid #00f;
  box-shadow: 0 0 8px 2px rgba(0, 0, 255, 0.6);
  transition: all 0.3s ease;
}

    *, *::before, *::after {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      overflow-x: hidden; /* Mencegah pengguliran horizontal */
    }

    body { 
      font-family: sans-serif; 
      max-width: 700px; 
      margin: auto; 
      padding: 20px 10px; /* Padding samping untuk layar kecil */
      min-height: 100vh; /* Memastikan body memenuhi tinggi layar */
    }
    
    label { font-weight: bold; }
    select, input { 
      width: 100%; 
      padding: 6px; 
      margin-top: 5px; 
    }
    .hidden { display: none; }
    .required { color: red; }
    .error { border: 2px solid red; }
    .success { border: 2px solid green; }
    .warning { background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; margin: 10px 0; border-radius: 5px; }
    
    /* Tombol Sticky: Kembali ke Layar Utama */
    #btnHome {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #ffc107;
      color: black;
      border: none;
      padding: 12px 16px;
      border-radius: 50px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      font-size: 16px;
      z-index: 9999;
    }
    #btnHome:hover {
      background: #e0a800;
    }
    @media (min-width: 768px) {
      #btnHome {
        display: none; /* Hanya muncul di HP/screen kecil */
      }
    }

    /* Penyesuaian untuk tampilan data agar responsif */
    .data-card {
      border: 1px solid #ddd;
      margin-bottom: 15px;
      padding: 15px;
      border-radius: 8px;
      background: #f9f9f9;
    }
    .data-grid {
      display: grid;
      grid-template-columns: 1fr; /* Tampilan satu kolom di layar kecil */
      gap: 10px;
      margin-bottom: 15px;
    }
    @media (min-width: 500px) {
      .data-grid {
        grid-template-columns: 1fr 1fr; /* Tampilan dua kolom di layar lebih besar */
      }
    }
    .data-images {
      display: flex;
      flex-direction: column; /* Tampilan vertikal di layar kecil */
      gap: 20px;
      margin-top: 15px;
    }
    @media (min-width: 500px) {
      .data-images {
        flex-direction: row; /* Tampilan horizontal di layar lebih besar */
      }
    }

    /* Memastikan elemen-elemen ini responsif */
    #signature-pad, #video, #canvas, #previewFoto {
      max-width: 100%;
      height: auto;
      width: 100%; /* Memastikan elemen mengikuti lebar container */
    }
   .header-gambar {
  display: flex;
  justify-content: center;   /* Pusatkan seluruh baris gambar */
  align-items: center;       /* Sejajarkan vertikal */
  gap: 20px;                 /* Jarak antar gambar */
  margin-bottom: 15px;
  text-align: center;
  flex-wrap: nowrap;         /* Jangan pindah ke baris baru */
}

.foto-kepala {
  width: 80px;
  height: auto;
}

.logo {
  width: 100px;
  height: auto;
}


.foto-kepala {
  width: 80px;
  height: auto;
}

.logo {
  width: 100px;
  height: auto;
}
</style>
</head>
<body>
   <body>

<!-- Gambar kepala daerah -->
<body>

<!-- Gambar kepala daerah -->
<div class="header-gambar">
  <img src="bupati.png" alt="Wakil Bupati" class="foto-kepala">
  <img src="logo-tubaba.png" alt="Logo Tubaba" class="logo">
  <img src="wakil-bupati.png" alt="Bupati" class="foto-kepala">
</div>


<h1 style="text-align: center;">BUKU TAMU INSPEKTORAT TUBABA</h1>


<div id="formSection">
<form id="bukuTamuForm">
<label>Nama: <span class="required">*</span></label>
<input id="nama" required type="text"/><br/><br/>

<label>INSTANSI/ASAL: <span class="required">*</span></label>
<select id="asal" required>
<option value="">-- Pilih Asal --</option>
<option value="INSTANSI">INSTANSI/UNIT KERJA</option>
<option value="MASYARAKAT">MASYARAKAT</option>
</select><br/><br/>

<div class="hidden" id="daftarInstansi">
<label>DAFTAR INSTANSI/UNIT KERJA: <span class="required">*</span></label>
<select id="instansi">
<option value="">-- Pilih Instansi --</option>
<option>SEKRETARIAT DAERAH</option>
<option>SEKRETARIAT DPRD</option>
<option>BADAN PERENCANAAN PEMBANGUNAN DAERAH</option>
<option>BADAN PENGELOLAAN KEUANGAN DAN ASET DAERAH</option>
<option>BADAN PENGELOLAAN PAJAK DAN RETRIBUSI DAERAH</option>
<option>BADAN KEPEGAWAIAN DAN PENGEMBANGAN SUMBER DAYA MANUSIA</option>
<option>BADAN KESATUAN BANGSA DAN POLITIK DAERAH</option>
<option>BADAN PENANGGULANGAN BENCANA DAERAH</option>
<option>DINAS LINGKUNGAN HIDUP</option>
<option>DINAS KESEHATAN</option>
<option>DINAS KEPENDUDUKAN DAN PENCATATAN SIPIL</option>
<option>DINAS KOPERASI, UMKM, PERINDUSTRIAN DAN PERDAGANGAN</option>
<option>DINAS SOSIAL</option>
<option>DINAS PEMUDA, OLAHRAGA DAN PARIWISATA</option>
<option>DINAS KOMUNIKASI DAN INFORMATIKA</option>
<option>DINAS PERUMAHAN, KAWASAN PERMUKIMAN DAN PERTANAHAN</option>
<option>DINAS PENANAMAN MODAL DAN PELAYANAN PERIZINAN TERPADU SATU PINTU</option>
<option>DINAS PENDIDIKAN DAN KEBUDAYAAN</option>
<option>DINAS KETAHANAN PANGAN</option>
<option>DINAS PEMBERDAYAAN MASYARAKAT DAN TIYUH</option>
<option>DINAS PEMBERDAYAAN PEREMPUAN DAN PERLINDUNGAN ANAK</option>
<option>DINAS PENGENDALIAN PENDUDUK DAN KELUARGA BERENCANA</option>
<option>DINAS PERHUBUNGAN</option>
<option>DINAS PERTANIAN</option>
<option>DINAS PETERNAKAN DAN KESEHATAN HEWAN</option>
<option>DINAS PEKERJAAN UMUM DAN PENATAAN RUANG</option>
<option>DINAS TENAGA KERJA DAN TRANSMIGRASI</option>
<option>DINAS PERIKANAN</option>
<option>DINAS PERPUSTAKAAN DAN KEARSIPAN</option>
<option>DINAS PEMADAM KEBAKARAN DAN PENYELAMATAN</option>
<option>SATUAN POLISI PAMONG PRAJA</option>
<option>BADAN PENGAWASAN KEUANGAN DAN PEMBANGUNAN (BPKP)</option>
<option>LAINNYA</option>
</select><br/><br/>
</div>

<div class="hidden" id="daftarMasyarakat">
<label>Kecamatan: <span class="required">*</span></label>
<select id="kecamatan">
<option value="">-- Pilih Kecamatan --</option>
<option value="Tulang Bawang Tengah">Tulang Bawang Tengah</option>
<option value="Tulang Bawang Udik">Tulang Bawang Udik</option>
<option value="Gunung Terang">Gunung Terang</option>
<option value="Gunung Agung">Gunung Agung</option>
<option value="Lambu Kibang">Lambu Kibang</option>
<option value="Way Kenanga">Way Kenanga</option>
<option value="Tumijajar">Tumijajar</option>
<option value="Pagar Dewa">Pagar Dewa</option>
<option value="Batu Putih">Batu Putih</option>
</select><br/><br/>

<label>Desa/Tiyuh: <span class="required">*</span></label>
<select id="desa">
<option value="">-- Pilih Desa --</option>
</select><br/><br/>
</div>

<label>PIHAK YANG DITEMUI: <span class="required">*</span></label>
<select id="pihakDitemui" required>
<option value="">-- Pilih Pihak yang Ditemui --</option>
<option>INSPEKTUR</option>
<option>SEKRETARIS</option>
<option>IRBANSUS</option>
<option>IRBAN 1</option>
<option>IRBAN 2</option>
<option>IRBAN 3</option>
<option>IRBAN 4</option>
</select><br/><br/>

<label>JENIS LAYANAN: <span class="required">*</span></label>
<select id="jenisLayanan" required>
<option value="">-- Pilih Jenis Layanan --</option>
<option>Permintaan Audit/Klarifikasi Khusus</option>
<option>Penanganan Pengaduan</option>
<option>Layanan Informasi Publik</option>
<option>Pembinaan & Konsultasi</option>
<option>Audit</option>
<option>Review</option>
<option>Evaluasi/Monitoring</option>
<option>Tindak Lanjut Temuan</option>
</select><br/><br/>

<label>URAIAN: <span class="required">*</span></label>
<textarea id="uraian" required oninput="autoResize(this)" style="overflow:hidden; resize:none; width:100%; min-height:60px;"></textarea><br/><br/>


<label>NOMOR HP: <span class="required">*</span></label>
<input id="nomorHp" inputmode="numeric" pattern="\d*" required type="text"/><br/><br/>

<label>Tanda Tangan: <span class="required">*</span></label>
<div class="warning" id="signatureWarning" style="display:none;">
‚ö†Ô∏è Tanda tangan wajib diisi!
</div>
<canvas height="200" id="signature-pad" style="border:1px solid #ccc; width: 100%;" width="700"></canvas><br/>
<button onclick="clearSignature()" type="button">üßπ Bersihkan Tanda Tangan</button><br/><br/>

<label>Foto: <span class="required">*</span></label>
<div class="warning" id="photoWarning" style="display:none;">
‚ö†Ô∏è Foto wajib diambil!
</div>
<video id="video" width="300" height="225" autoplay muted playsinline></video><br/>
<canvas id="canvas" width="300" height="225" style="display:none;"></canvas>
<br/>
<button type="button" onclick="ambilFoto()">üì∏ Ambil Foto</button>
<br/><br/>
<img id="previewFoto" style="width:300px;display:none;border:1px solid #ccc;margin-bottom:10px;" alt="Hasil Foto">

<button type="button" onclick="simpanData()" style="font-size: 18px;">üíæ Simpan Data</button>

</form>
</div>
<div style="margin-bottom: 20px;">
<button type="button" onclick="showForm()" id="btnForm" style="background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin-right: 10px;">üìù Form Input</button>
<button type="button" onclick="showData()" id="btnData" style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin-right: 10px;">üìä Lihat Data (<span id="dataCount">0</span>)</button>
<button type="button" onclick="exportData()" style="background: #17a2b8; color: white; padding: 10px 20px; border: none; border-radius: 5px;">üíæ Export Data</button>
</div>

<div id="dataSection" style="display: none;">
<h2>üìä DATA BUKU TAMU</h2>
<div style="margin-bottom: 20px;">
<button type="button" onclick="clearAllData()" style="background: #dc3545; color: white; padding: 8px 15px; border: none; border-radius: 5px;">üóëÔ∏è Hapus Semua Data</button>
</div>
<div id="dataContainer">
<p style="text-align: center; color: #666;">Belum ada data yang tersimpan</p>
</div>
</div>

<script>
    // Penyesuaian lebar canvas saat jendela diubah ukurannya
    const signatureCanvas = document.getElementById('signature-pad');
    function resizeCanvas() {
  const originalWidth = 700;
  const newWidth = Math.min(window.innerWidth - 40, originalWidth);

  // Simpan isi kanvas sebelum resize
  const tempData = signatureCanvas.toDataURL();

  // Atur ulang lebar kanvas (ini akan menghapus isi kanvas)
  signatureCanvas.width = newWidth;

  // Gambar ulang dari data yang sudah disimpan
  const img = new Image();
  img.onload = function () {
    ctx.drawImage(img, 0, 0);
  };
  img.src = tempData;
}

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas(); // Panggil saat halaman pertama kali dimuat

    const asal = document.getElementById("asal");
    const daftarInstansi = document.getElementById("daftarInstansi");
    const daftarMasyarakat = document.getElementById("daftarMasyarakat");
    const kecamatan = document.getElementById("kecamatan");
    const desa = document.getElementById("desa");
    const instansi = document.getElementById("instansi");

    // Data desa
    const dataDesa = {
      "Lambu Kibang": ["Kibang Budi Jaya", "Lesung Bhakti Jaya", "Mekar Sari Jaya", "Pagar Jaya", "Gunung Sari", "Sumber Rejo", "Kibang Yekti Jaya", "Kibang Tri Jaya", "Gilang Tunggal Makarta", "Kibang Mulya Jaya"],
      "Tulang Bawang Tengah": ["Penumangan", "Penumangan Baru", "Menggala Mas", "Bandar Dewa", "Panaragan", "Panaragan Jaya Indah", "Panaragan Jaya Utama", "Tirta Kencana", "Tirta Makmur", "Pulung Kencana", "Mulya Jaya", "Mulya Kencana", "Candra Mukti", "Candra Kencana", "Candra Jaya", "Tunas Asri", "Wonokerto", "Mekar Asri", "Marga Asri"],
      "Gunung Agung": ["Tunas Jaya", "Mulya Jaya", "Mulya Sari", "Mekar Jaya", "Bangun Jaya", "Dwikora Jaya", "Marga Jaya", "Sumber Jaya", "Sumber Rejeki", "Jaya Murni", "Wonorejo", "Suka Jaya", "Tri Jaya Tunggal"],
      "Tumijajar": ["Murni Jaya", "Daya Asri", "Daya Sakti", "Makarti", "Sumber Rejo", "Margodadi", "Gunung Menanti", "Gunung Timbul", "Margo Mulyo"],
      "Way Kenanga": ["Agung Jaya", "Mercubuana", "Balam Jaya", "Pagar Buana", "Indraloka I", "Indraloka II", "Balam Asri", "Indraloka Jaya", "Indraloka Mukti", "Sido Agung"],
      "Batu Putih": ["Toto Katon", "Sakti Jaya", "Margo Mulya", "Margo Dadi", "Marga Sari", "Mulyo Sari", "Toto Makmur", "Panca Marga", "Sido Makmur", "Toto Wonodadi"],
      "Gunung Terang": ["Setia Bumi", "Setia Agung", "Mulya Jadi", "Gunung Agung", "Gunung Terang", "Toto Mulyo", "Kagungan Jaya", "Terang Mulya", "Terang Makmur", "Rerang Bumi Agung"],
      "Tulang Bawang Udik": ["Kagungan Ratu", "Kartaraharja", "Kartasari", "Marga Kencana", "Waysido", "Kagungan Ratu Agung", "Gunung Katun Tanjungan", "Gedung Ratu", "Gunung Katun Malay", "Karta", "Karta Tanjung Selamat", "Karta Raya", "Way Sido"],
      "Pagar Dewa": ["Bujung Dewa", "Bujungsari Marga", "Marga Jaya Indah", "Pagar Dewa", "Cahyo Randu", "Pagar Dewa Suka Mulya"]
    };

    // Event listener untuk perubahan asal
    asal.addEventListener("change", function () {
      daftarInstansi.classList.add("hidden");
      daftarMasyarakat.classList.add("hidden");
      
      // Reset required attributes
      instansi.removeAttribute('required');
      kecamatan.removeAttribute('required');
      desa.removeAttribute('required');
      
      if (this.value === "INSTANSI") {
        daftarInstansi.classList.remove("hidden");
        instansi.setAttribute('required', '');
      } else if (this.value === "MASYARAKAT") {
        daftarMasyarakat.classList.remove("hidden");
        kecamatan.setAttribute('required', '');
        desa.setAttribute('required', '');
      }
    });

    // Event listener untuk perubahan kecamatan
    kecamatan.addEventListener("change", function () {
      const desaList = dataDesa[this.value] || [];
      desa.innerHTML = '<option value="">-- Pilih Desa --</option>';
      desaList.forEach(nama => {
        const opt = document.createElement("option");
        opt.value = nama;
        opt.textContent = nama;
        desa.appendChild(opt);
      });
    });

    // Validasi nomor HP hanya angka
    const nomorHp = document.getElementById('nomorHp');
    nomorHp.addEventListener('keypress', function (e) {
      const char = String.fromCharCode(e.which);
      if (!/[0-9]/.test(char)) {
        e.preventDefault();
      }
    });
    nomorHp.addEventListener('input', function () {
      this.value = this.value.replace(/\D/g, '');
    });

    // Tanda tangan
    const canvas = document.getElementById('signature-pad');
    const ctx = canvas.getContext('2d');
    ctx.strokeStyle = '#0000FF';
    ctx.lineWidth = 2.8;
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';


    let drawing = false;
    let hasSignature = false;

   function startDrawing(e) {
  drawing = true;
  hasSignature = true;
  ctx.strokeStyle = '#0000FF'; // Set ulang warna biru setiap kali mulai menggambar
  ctx.lineWidth = 2.8;
  ctx.lineCap = 'round';
  ctx.lineJoin = 'round';
  const pos = getCanvasPos(e);
  ctx.beginPath();
  ctx.moveTo(pos.x, pos.y);
}


    function draw(e) {
      if (!drawing) return;
      const pos = getCanvasPos(e);
      ctx.lineTo(pos.x, pos.y);
      ctx.stroke();
    }

    function stopDrawing() {
      drawing = false;
    }

    // Mouse events
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);

    // Touch events
    canvas.addEventListener('touchstart', e => {
      e.preventDefault();
      startDrawing(e);
    });
    canvas.addEventListener('touchmove', e => {
      e.preventDefault();
      draw(e);
    });
    canvas.addEventListener('touchend', e => {
      e.preventDefault();
      stopDrawing();
    });

    function getCanvasPos(e) {
      const rect = canvas.getBoundingClientRect();
      if (e.touches && e.touches[0]) {
        return {
          x: e.touches[0].clientX - rect.left,
          y: e.touches[0].clientY - rect.top
        };
      }
      return {
        x: e.offsetX,
        y: e.offsetY
      };
    }

    function clearSignature() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      hasSignature = false;
    }

    // Kamera dan foto
    const video = document.getElementById('video');
    const canvasFoto = document.getElementById('canvas');
    const previewFoto = document.getElementById('previewFoto');
    let hasPhoto = false;
    let lastFotoTime = 0;
    
    // Array untuk menyimpan data buku tamu
    let dataBukuTamu = [];

    // Akses kamera
   
let streamAktif = false;

async function ambilFoto() {
  const button = event.target;

  // Jika kamera belum aktif, aktifkan kamera terlebih dahulu
  if (!streamAktif) {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
      video.srcObject = stream;
      streamAktif = true;

      button.innerHTML = 'üì∏ Ambil Foto Sekarang';
      button.style.background = '#ffc107';
      return; // Jangan langsung ambil foto di awal
    } catch (error) {
      console.error("Tidak dapat mengakses kamera:", error);
      alert("‚ùå Gagal mengakses kamera!\n\nPastikan izin kamera sudah diberikan.");
      return;
    }
  }

  // Kamera sudah aktif, ambil foto sekarang
  const context = canvasFoto.getContext('2d');
  canvasFoto.width = video.videoWidth || 300;
  canvasFoto.height = video.videoHeight || 225;
  context.drawImage(video, 0, 0, canvasFoto.width, canvasFoto.height);

  previewFoto.src = canvasFoto.toDataURL('image/png');
  previewFoto.style.display = 'block';
  canvasFoto.style.display = 'none';
  hasPhoto = true;

  // Tampilkan feedback sukses
  const originalText = button.innerHTML;
  button.innerHTML = '‚úÖ Foto Berhasil!';
  button.style.background = '#28a745';

  setTimeout(() => {
    button.innerHTML = originalText;
    button.style.background = '';
  }, 2000);
}

    // Validasi dan simpan data
    function simpanData() {
      const form = document.getElementById('bukuTamuForm');
      const signatureWarning = document.getElementById('signatureWarning');
      const photoWarning = document.getElementById('photoWarning');
      
      let isValid = true;
      
      // Reset warnings
      signatureWarning.style.display = 'none';
      photoWarning.style.display = 'none';
      
      // Validasi form HTML5
      if (!form.checkValidity()) {
        form.reportValidity();
        isValid = false;
      }
      
      // Validasi tanda tangan
      if (!hasSignature) {
        signatureWarning.style.display = 'block';
        canvas.classList.add('error');
        isValid = false;
      } else {
        canvas.classList.remove('error');
        canvas.classList.add('success');
      }
      
      // Validasi foto
      if (!hasPhoto) {
        photoWarning.style.display = 'block';
        video.classList.add('error');
        isValid = false;
      } else {
        video.classList.remove('error');
        video.classList.add('success');
      }
      
      // Validasi khusus untuk instansi/masyarakat
      if (asal.value === "INSTANSI" && !instansi.value) {
        alert("Silakan pilih instansi/unit kerja!");
        instansi.focus();
        isValid = false;
      }
      
      if (asal.value === "MASYARAKAT") {
        if (!kecamatan.value) {
          alert("Silakan pilih kecamatan!");
          kecamatan.focus();
          isValid = false;
        } else if (!desa.value) {
          alert("Silakan pilih desa/tiyuh!");
          desa.focus();
          isValid = false;
        }
      }
      
      if (isValid) {
        // Ambil semua data
        const formData = {
          nama: document.getElementById('nama').value,
          asal: asal.value,
          instansi: instansi.value,
          kecamatan: kecamatan.value,
          desa: desa.value,
          pihakDitemui: document.getElementById('pihakDitemui').value,
          jenisLayanan: document.getElementById('jenisLayanan').value,
          uraian: document.getElementById('uraian').value,
          nomorHp: nomorHp.value,
          tandaTangan: canvas.toDataURL('image/png'),
          foto: canvasFoto.toDataURL('image/png'),
          timestamp: new Date().toLocaleString('id-ID')
        };
        
        // Simpan data ke array
        dataBukuTamu.push(formData);
        
        // Update counter
        updateDataCounter();
        
        console.log("Data lengkap:", formData);
        console.log("Total data tersimpan:", dataBukuTamu.length);
        alert("‚úÖ Data berhasil disimpan!\n\nSemua field telah terisi lengkap:\n- Tanda tangan ‚úì\n- Foto ‚úì\n- Data personal ‚úì\n\nTotal data: " + dataBukuTamu.length);
        
        // RESET FORM OTOMATIS SETELAH SIMPAN
        resetFormComplete();
      } else {
        alert("‚ùå Mohon lengkapi semua data yang diperlukan:\n- Isi semua field yang bertanda (*)\n- Buat tanda tangan\n- Ambil foto");
      }
    }

    // FUNGSI RESET FORM LENGKAP
    function resetFormComplete() {
      // Reset semua input text dan select
      const form = document.getElementById('bukuTamuForm');
      form.reset();
      
      // Reset variabel status
      hasSignature = false;
      hasPhoto = false;
      
      // Reset tanda tangan
      clearSignature();
      
      // Reset foto
      previewFoto.style.display = 'none';
      previewFoto.src = '';
      
      // Reset dropdown dinamis
      daftarInstansi.classList.add("hidden");
      daftarMasyarakat.classList.add("hidden");
      
      // Reset daftar desa
      desa.innerHTML = '<option value="">-- Pilih Desa --</option>';
      
      // Reset required attributes
      instansi.removeAttribute('required');
      kecamatan.removeAttribute('required');
      desa.removeAttribute('required');
      
      // Reset visual styling (hapus border error/success)
      const elements = [canvas, video, document.getElementById('nama'), asal, 
                       document.getElementById('pihakDitemui'), document.getElementById('jenisLayanan'),
                       document.getElementById('uraian'), nomorHp];
      elements.forEach(el => {
        el.classList.remove('error', 'success');
      });
      
      // Reset warnings
      document.getElementById('signatureWarning').style.display = 'none';
      document.getElementById('photoWarning').style.display = 'none';
      
      // Focus ke field pertama untuk input berikutnya
      document.getElementById('nama').focus();
      
      console.log("Form telah direset dan siap untuk input data baru");
    }

    // FUNGSI UNTUK MENAMPILKAN/MENYEMBUNYIKAN SECTION
    function showForm() {
      document.getElementById('formSection').style.display = 'block';
      document.getElementById('dataSection').style.display = 'none';
      document.getElementById('btnForm').style.background = '#007bff';
      document.getElementById('btnData').style.background = '#6c757d';
    }

    function showData() {
      document.getElementById('formSection').style.display = 'none';
      document.getElementById('dataSection').style.display = 'block';
      document.getElementById('btnForm').style.background = '#6c757d';
      document.getElementById('btnData').style.background = '#28a745';
      displayData();
    }

    // FUNGSI UNTUK UPDATE COUNTER DATA
    function updateDataCounter() {
      document.getElementById('dataCount').textContent = dataBukuTamu.length;
    }

    // FUNGSI UNTUK MENAMPILKAN DATA
    function displayData() {
      const container = document.getElementById('dataContainer');
      
      if (dataBukuTamu.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666;">Belum ada data yang tersimpan</p>';
        return;
      }

      let html = '';
      dataBukuTamu.forEach((data, index) => {
        html += `
        <div class="data-card">
          <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 10px;">
            <h3 style="margin: 0; color: #333;">Tamu #${index + 1}</h3>
            <button onclick="deleteData(${index})" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">üóëÔ∏è Hapus</button>
          </div>
          
          <div class="data-grid">
            <div><strong>Nama:</strong> ${data.nama}</div>
            <div><strong>Asal:</strong> ${data.asal}</div>
            
            ${data.instansi ? `<div><strong>Instansi:</strong> ${data.instansi}</div>` : ''}
            ${data.kecamatan ? `<div><strong>Kecamatan:</strong> ${data.kecamatan}</div>` : ''}
            ${data.desa ? `<div><strong>Desa:</strong> ${data.desa}</div>` : ''}
            
            <div><strong>Pihak Ditemui:</strong> ${data.pihakDitemui}</div>
            <div><strong>Jenis Layanan:</strong> ${data.jenisLayanan}</div>
            <div><strong>Nomor HP:</strong> ${data.nomorHp}</div>
            <div><strong>Waktu:</strong> ${data.timestamp}</div>
          </div>
          
          <div><strong>Uraian:</strong> ${data.uraian}</div>
          
          <div class="data-images">
            <div>
              <strong>Tanda Tangan:</strong><br>
              <img src="${data.tandaTangan}" style="border: 1px solid #ccc; max-width: 200px; height: auto;">
            </div>
            <div>
              <strong>Foto:</strong><br>
              <img src="${data.foto}" style="border: 1px solid #ccc; max-width: 200px; height: auto;">
            </div>
          </div>
        </div>`;
      });

      container.innerHTML = html;
    }

    // FUNGSI UNTUK MENGHAPUS DATA INDIVIDUAL
    function deleteData(index) {
      if (confirm('Yakin ingin menghapus data tamu #' + (index + 1) + '?')) {
        dataBukuTamu.splice(index, 1);
        updateDataCounter();
        displayData();
        alert('Data berhasil dihapus!');
      }
    }

    // FUNGSI UNTUK MENGHAPUS SEMUA DATA
    function clearAllData() {
      if (confirm('Yakin ingin menghapus SEMUA data buku tamu?')) {
        dataBukuTamu = [];
        updateDataCounter();
        displayData();
        alert('Semua data berhasil dihapus!');
      }
    }

    // FUNGSI UNTUK EXPORT DATA
    function exportData() {
      if (dataBukuTamu.length === 0) {
        alert('Tidak ada data untuk di-export!');
        return;
      }

      // Buat CSV content
      let csvContent = "No,Nama,Asal,Instansi,Kecamatan,Desa,Pihak Ditemui,Jenis Layanan,Uraian,Nomor HP,Waktu\n";
      
      dataBukuTamu.forEach((data, index) => {
        csvContent += `${index + 1},"${data.nama}","${data.asal}","${data.instansi || ''}","${data.kecamatan || ''}","${data.desa || ''}","${data.pihakDitemui}","${data.jenisLayanan}","${data.uraian}","${data.nomorHp}","${data.timestamp}"\n`;
      });

      // Download CSV
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      const url = URL.createObjectURL(blob);
      link.setAttribute("href", url);
      link.setAttribute("download", `buku_tamu_${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      alert('Data berhasil di-export ke file CSV!');
    }
    // Tambahkan fungsi ini di bawah exportData
    function autoResize(textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = textarea.scrollHeight + 'px';
    }

</script>
<script>
    // Tambahan Kode untuk Overlay
    const overlay = document.getElementById('overlay-transparan');

    // Menampilkan overlay saat tautan atau tombol diklik
    document.addEventListener('click', function(event) {
        if (event.target.closest('a') || event.target.closest('button')) {
            overlay.style.display = 'block';
        }
    });

    // Sembunyikan overlay saat halaman dimuat
    window.addEventListener('load', function() {
        overlay.style.display = 'none';
    });

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('service-worker.js')
          .then(function(reg) {
            console.log('Service Worker registered ‚úîÔ∏è', reg);
          }).catch(function(err) {
            console.log('Service Worker failed ‚ùå', err);
          });
      });
    }
</script>

</body>
</html>
